<!DOCTYPE html>
<!--
⣿⣿⣿⣿⣿⠃⢀⡾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠄⣿⣿⢿⢏⣼⣷⢳⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣯⡿⠒
⣿⣿⣿⣿⠃⢀⣿⡇⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡀⣿⣿⢏⣾⣿⣿⡼⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣻⠁⠄
⣿⣟⡫⠉⢠⣶⣤⡄⣉⠛⣿⢿⣿⣿⣿⣿⣿⣿⣿⡇⢹⢏⣾⢿⣛⠛⠃⠙⠯⢿⡯⣿⣿⣿⣿⣿⣿⠿⡄⠄
⣿⢿⡏⢠⣿⣿⣿⣧⣿⣷⣾⣾⣿⣿⣿⣿⣿⣿⣿⡇⢈⣎⣼⣷⣿⣿⣿⣎⣿⣷⣶⣥⣿⣿⣿⣿⣿⣷⣇⠄
⣿⡟⢠⣿⣿⣿⣿⣿⡜⣿⣿⣿⣿⣿⣿⠙⣿⣿⣿⡇⣾⣿⣿⣿⣿⣿⣿⣿⣌⠾⡿⣿⣿⣿⣿⣿⣿⣿⣯⠢
⣿⢁⣾⣿⣿⣿⣿⣿⣷⣹⣿⣿⣿⣿⣿⠄⠘⣿⣿⣿⢿⣿⣿⣿⣿⣿⣿⣿⣿⣎⢓⣿⣿⣿⡏⠻⡿⣿⣷⣾
⡏⣼⣿⣿⣿⣿⣿⣿⣿⣷⡵⣿⣿⣿⣿⡇⠄⠘⢿⣺⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣦⡻⣿⣿⣿⡄⠈⠙⢿⣿
⡰⣿⣿⠯⠍⠙⠛⠷⣯⣿⣿⣎⢿⣿⣿⡇⠄⠄⡈⢻⡟⣿⣿⢿⣿⠿⠿⣿⣿⣿⣿⣿⣎⢟⣿⣿⡄⠄⠄⠉
⢧⢧⠆⠄⠄⢀⣀⣀⠄⠙⢿⣿⣯⡿⣿⣷⠄⠄⣿⣦⡑⢴⠾⠛⠋⠁⠄⠄⠈⠙⠻⣿⣿⣷⢍⠻⣽⣂⠄⠄
⣟⠌⣴⣾⣶⣿⣿⣿⣿⣶⣾⣿⣿⣿⣮⡳⠆⠄⢹⣿⣿⡶⠋⣠⠄⢀⣠⣤⣄⣀⡀⠄⠙⣿⣸⣷⣮⣜⠳⠲
⡟⣿⡼⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣮⣀⠘⣿⣿⣿⣿⣿⣾⣿⣿⣿⣿⣿⣿⣿⣶⣱⣿⣿⣿⣿⣿⣆
⠈⠑⡽⣹⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡣⣻⣿⣿⣿⣿⣯⡟
⠄⠄⢻⣶⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⣵⣿⣿⣿⣿⣿⣿⣿⣿
⠄⠄⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⡟⠿⠿⠛⠻⢿⣿⣿⡿⢿⣿⣿⣿⣿⣿⣿⡿⣫⣞⢏⢋⣵⣾⣿⣿⣿⣿⣿
⠄⠄⠸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣇⠄⣀⣠⣤⣤⣀⠈⠄⣿⣿⣿⣿⣿⣿⣭⣬⣷⣾⢏⢶⣿⣿⣿⣿⣿⣿⡿
⠄⠄⠄⠙⢿⣿⣿⣿⣿⣿⣿⣿⣿⡼⣿⣿⣿⣿⣿⣿⣆⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⣼⣿⣿⣿⣿⣿⣿⠟⠄
⠄⠄⠄⠄⠄⠈⠛⢿⣿⣿⣿⣿⣿⣷⣽⣿⣿⣿⡿⣫⣾⣿⣿⣿⣿⣿⣿⣿⣿⠟⢁⣯⣽⣿⣿⣿⣿⠏⠄⠄
⠄⠄⠄⠄⠄⠄⠄⠄⠉⠻⢿⣿⣿⣿⣿⣿⣶⣶⣿⣿⣿⣿⣿⣿⡿⣿⡫⠙⠄⠄⢸⣿⣿⣿⣿⣿⠋⠄⠄⢠
⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠙⠻⠿⣿⣿⣿⡿⢿⣛⣿⣭⣾⣿⣿⡇⠂⠄⠄⢸⣿⣿⣿⣿⠃⠄⠄⠄⠄
⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⡀⠰⣶⣿⣿⣿⣿⣿⣿⣿⠿⠃⠄⢙⡄⡫⣿⣿⣿⠃⠄⠄⠄⠄⠄
⠄⢀⠄⣤⣤⣄⣀⠄⠄⠄⠄⠄⠄⠄⣾⠄⠄⣿⣿⣿⣿⣿⣿⠛⠁⠄⣠⡴⠛⠇⢹⣿⡯⠫⢀⣀⣀⣀⣀⣠
⣴⣿⣷⣿⣿⣿⣿⣿⠋⠄⠄⣰⡇⢰⡏⠄⢠⣿⣿⣿⡿⠋⠄⢀⣠⠞⠁⢀⠄⠄⢸⡿⣱⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⠃⠄⠄⢠⣿⣁⣼⡇⠄⢸⣿⡿⠋⠄⢀⣤⠋⠄⣠⣾⡟⠄⠄⠸⣴⣿⣿⣿⣿⣿⣿⣿⣿

 EZGİSS I LOVE YOU <3
-->


<html>

<head>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, arrayUnion, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
        import { getMessaging, getToken } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-messaging.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCfbStb3I1qZYqYKHrP_2wcGvOwUi4GrRs",
            authDomain: "gigi-67cd0.firebaseapp.com",
            databaseURL: "https://gigi-67cd0-default-rtdb.firebaseio.com",
            projectId: "gigi-67cd0",
            storageBucket: "gigi-67cd0.appspot.com",
            messagingSenderId: "813483059670",
            appId: "1:813483059670:web:7c03147ba03344098b1c77",
            measurementId: "G-55Y887Q50X"
        };

        // Firebase'i başlat
        const app = initializeApp(firebaseConfig);
        const firestore = getFirestore(app);
        const messaging = getMessaging(app);

        async function requestNotificationPermission() {
            try {
                const permission = await Notification.requestPermission();
                if (permission === "granted") {
                    console.log("Bildirim izni verildi.");
                    const currentToken = await getToken(messaging, { vapidKey: "BFPLccnzTZS0qa-fwxWwVZSMBJ5wrEkKWdDsbqGmbS-PQ-WTY9fASJ5KQrvQwj9YB1Hx5KlScpY_pk78paKoY8M" });
                    if (currentToken) {
                        console.log("Token:", currentToken);
                        await saveTokenToFirestore(currentToken);
                    } else {
                        console.log("Kayıt token'ı mevcut değil.");
                    }
                } else {
                    console.log("Bildirim izni reddedildi.");
                }
            } catch (error) {
                console.error("Bildirim izni alınırken hata:", error);
            }
        }

        async function saveTokenToFirestore(token) {
            const userId = "31"; // Tüm kullanıcılar için sabit bir ID
            const tokenRef = doc(firestore, "tokens", userId);

            // Belgeyi al
            const docSnap = await getDoc(tokenRef);

            if (docSnap.exists()) {
                // Belge zaten var, token'ı dizinin sonuna ekle
                await updateDoc(tokenRef, {
                    tokens: arrayUnion(token), // Yeni token'ı diziye ekle
                    timestamp: Date.now()
                });
            } else {
                // Belge yok, yeni belge oluştur ve token'ı ekle
                await setDoc(tokenRef, {
                    tokens: [token], // Yeni token ile dizi oluştur
                    timestamp: Date.now()
                });
            }
        }

        async function getTokensFromFirestore() {
            const tokensSnapshot = await getDocs(collection(firestore, "tokens"));
            return tokensSnapshot;
        }

        async function sendNotificationToAllUsers(song) {
            const message = {
                notification: {
                    title: "Günün Şarkısı",
                    body: song.title,
                    icon: "assets/images/apos.ico"
                },
                data: {
                    songId: song.id // İsteğe bağlı: şarkı ile ilgili ek veriler
                }
            };

            const tokensQuery = await getTokensFromFirestore();
            const tokens = tokensQuery.docs.flatMap(doc => doc.data().tokens); // Her belgedeki token'ları al

            // Bildirim gönderimi için FCM API'sını kullanın
            const response = await fetch("https://fcm.googleapis.com/fcm/send", {
                method: "POST",
                headers: {
                    "Authorization": "BFPLccnzTZS0qa-fwxWwVZSMBJ5wrEkKWdDsbqGmbS-PQ-WTY9fASJ5KQrvQwj9YB1Hx5KlScpY_pk78paKoY8M", // Sunucu anahtarınızı buraya ekleyin
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    registration_ids: tokens,
                    ...message
                })
            });

            const result = await response.json();
            console.log("Notification sent:", result);
        }

        function scheduleDailySongNotification() {
            const now = new Date();
            const nextMidnight = new Date();
            nextMidnight.setHours(24, 0, 0, 0); // Gelecek gece yarısı

            const timeToNextMidnight = nextMidnight - now;

            setTimeout(async () => {
                const dailySong = await getDailySong(); // Günlük şarkıyı alın
                await sendNotificationToAllUsers(dailySong); // Bildirim gönder
                scheduleDailySongNotification(); // Tekrar zamanlayıcıyı ayarlayın
            }, timeToNextMidnight);
        }

        // Sayfa yüklendiğinde izin isteme fonksiyonunu çağır
        window.onload = requestNotificationPermission;

    </script>


    <script src="assets/js/ezgigi.js"></script>
    <script type="text/javascript">
        animateTitle("Ezgi Seni Seviyorum");
    </script>
    <title>Ezgi Seni Seviyorum</title>
    <meta name="og:description" content="Ezgi bu mesajımı görüyorsan seni çok sevdiğimi bilmeni istiyorum." />
    <meta property="og:image" content="./assets/images/yanankalp.png">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <meta property="og:url" content="https://texa.anlayana.com/" />
    <meta property="og:type" content="TEXA's Website." />
    <link rel="shortcut icon" href="./assets/images/sarılıkalp.ico" />
    <meta http-equiv="content-language" content="en" />
    <meta charset="utf-8" />
    <link rel="stylesheet" href="assets/css/gigi.css" />

</head>

<body>


    <!--Back Ground-->
    <canvas id="c"></canvas>
    <div id="loading-animation" class="loading-animation">
        <div class="spinner"></div>
        <!-- Loading animasyonu -->
        <div class="flex-container">
            <div class="unit">
                <div class="heart">
                    <div class="heart-piece-0"></div>
                    <div class="heart-piece-1"></div>
                    <div class="heart-piece-2"></div>
                    <div class="heart-piece-3"></div>
                    <div class="heart-piece-4"></div>
                    <div class="heart-piece-5"></div>
                    <div class="heart-piece-6"></div>
                    <div class="heart-piece-7"></div>
                    <div class="heart-piece-8"></div>
                </div>
            </div>
        </div>
    </div>
    <script src="assets/js/gigi.js"></script>
    <div class="boxcontainer unclickable">
        <div class="box clickable" id="box" style="display: block">
            <div id="songOfTheDay">
                <h2 class="rgb">Günün Şarkısı</h2>
                <div align="center" class="clickable" id="spotifyEmbed"></div>
            </div>
            <br>
            <br>
            <br>
            <h2 class="sparkle-text">EZGİ İYİ Kİ VARSIN</h2>
            <br>
            <br>
            <br>
            <br>
            <iframe style="border-radius:10px"
                src="https://open.spotify.com/embed/playlist/1gk8wuLb7TMOoOM6dgGv1A?utm_source=generator&theme=0"
                width="50%" height="152" frameborder="0"
                allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                loading="lazy"></iframe>


        </div>

    </div>
</body>
<script>
    var b = document.body;
    var c = document.getElementsByTagName('canvas')[0];
    var a = c.getContext('2d');
    document.body.clientWidth; 
</script>

</html>

<!-- LVBEL C5 BABA SARKI YAPTI SALLADI ÜLKEYİ EĞHHĞĞHĞHĞ-->